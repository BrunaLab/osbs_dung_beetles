---
title: "OSBS Dung Beetles Summary Info"
author: "Emilio M. Bruna"
date: "10/15/2021"
output: pdf_document
---

```{r setup, include=FALSE}
library(tidyverse)
library(kableExtra)
library(knitr)
```
```{r load_data, cached=TRUE, echo=FALSE, message = FALSE, , warning = FALSE}
btl_data_long<-read_csv("./data_clean/dung_btl_data_clean.csv")
# name_codes<-read_csv("./data_clean/name_codes.csv")
# btl_data_long<-left_join(btl_data_long,name_codes)
```

```{r, echo=FALSE, message = FALSE, , warning = FALSE}
# this is to make sure numbers are printed in full, not in scientific notation
inline_hook <- function(x) {
  if (is.numeric(x)) {
    format(x, digits = 2)
  } else x
}
knitr::knit_hooks$set(inline = inline_hook)
```


```{r total_n, echo=FALSE, message = FALSE, , warning = FALSE}
### Total number of beetles sampled, all dates and spp combined
total_N<-btl_data_long %>% summarise(n=sum(count, na.rm=TRUE))
```
### Total number of beetles sampled, all dates and spp combined: `r total_N`

```{r total_n_sample, echo=FALSE, message = FALSE, , warning = FALSE}
# total number of beetles sampled each round
total_N_sample<-btl_data_long %>%
  group_by(sample_round) %>% 
  summarise(n=sum(count, na.rm=TRUE)) %>% 
  arrange(sample_round)
```

<!-- `r kable(total_N_sample, caption = "total number of beetles sampled each round") %>% kable_styling()`  -->


```{r total_n_hab, echo=FALSE, message = FALSE, , warning = FALSE}
### total number of beetles sampled by habitat
total_N_habitat<-btl_data_long %>% group_by(habitat) %>% summarise(n=sum(count, na.rm=TRUE))
```

<!-- `r kable(total_N_habitat, caption ="total number of beetles sampled by habitat") %>% kable_styling()` -->


```{r total_n_spp, echo=FALSE, message = FALSE, , warning = FALSE}
### total number of beetles sampled by species
spp_totals<-btl_data_long %>% 
  group_by(sp_code,genus,species) %>% 
  summarise(n=sum(count, na.rm=TRUE)) %>% 
  arrange(desc(n))
```

<!-- `r kable(spp_totals, caption = "total number of beetles sampled by species") %>% kable_styling()` -->

\newpage

```{r fig1, echo=FALSE, message = FALSE, , warning = FALSE}
# Load Library


# Create a Faceted LineGraph using
# facet_wrap Function.

btl_order <- btl_data_long %>%
  group_by(sp_code) %>%
  summarize(n=sum(count, na.rm=TRUE)) %>%
  arrange(desc(n)) %>%
  mutate(sp_code = reorder(sp_code, desc(n)))


levels(btl_order$sp_code)

# %>%
#   ggplot(aes(sp_code, n)) +
#   geom_col(show.legend = FALSE)

# btl_order$sp_code


btl_data_sums<-btl_data_long %>%
  group_by(sample_round,sp_code,habitat) %>%
  summarize(n=sum(count, na.rm=TRUE)) %>%
  arrange(sample_round,desc(n))

btl_data_sums_winter<-btl_data_long %>%
  filter(sample_round<6) %>%
  group_by(sample_round,sp_code,habitat) %>%
  summarize(n=sum(count, na.rm=TRUE)) %>%
  arrange(sample_round,desc(n))

# data<-btl_data_sums %>% filter(sp_code=="c_vig"|sp_code=="d_car")
# data<-btl_data_sums %>% 
#   filter(sp_code!="a_lec") %>% 
#   filter(sp_code!="o_tub") %>% 
#   filter(sp_code!="a_cam") %>% 
#   filter(sp_code!="m_bis") %>% 
#   filter(sp_code!="h__") %>% 
#   filter(sp_code!="a_stu") %>% 
#   filter(sp_code!="m_pun")
# data<-btl_data_sums %>%
#   filter(n<20)
data<-btl_data_sums
fig1<-ggplot(data, 
             aes(x=sample_round, 
                 y=n, 
                 group=habitat, 
                 color=habitat)) +
  geom_line()+
  geom_point()+
  facet_wrap(vars(sp_code))
  # facet_wrap(vars(sp_code),scales="free",ncol = 3)
fig1
```

